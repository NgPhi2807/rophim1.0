import{j as a}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.BVOCwoKb.js";import{r as V,a as A}from"./movieUtils.BzFiPXDS.js";function G({initialData:m,initialSlug:h,baseUrl:y,initialLimit:g,tittle:S}){const[p,w]=r.useState(m?.items||[]),[_,F]=r.useState(m?.params?.pagination||{current_page:1,total_pages:1}),[n,j]=r.useState(!1),[u,N]=r.useState(null),[b,C]=r.useState(!1),[o,M]=r.useState(h),[t,P]=r.useState(()=>{const e=m?.params||{};return{quoc_gia:e.filterCountry?.[0]||"",the_loai:e.filterCategory?.[0]||"",ngon_ngu:e.filterType?.[0]||"",nam_phat_hanh:e.filterYear?.[0]||"",sort_field:e.sortField||"_id",sort_type:e.sortType||"desc"}}),i=_.current_page,f=_.total_pages,q=[{label:"Tất cả",value:""},{label:"Việt Nam",value:"viet-nam"},{label:"Hàn Quốc",value:"han-quoc"},{label:"Mỹ",value:"my"},{label:"Trung Quốc",value:"trung-quoc"},{label:"Nhật Bản",value:"nhat-ban"},{label:"Thái Lan",value:"thai-lan"},{label:"Hồng Kông",value:"hong-kong"},{label:"Đài Loan",value:"dai-loan"},{label:"Ấn Độ",value:"an-do"},{label:"Anh",value:"anh"},{label:"Pháp",value:"phap"},{label:"Canada",value:"canada"},{label:"Đức",value:"duc"},{label:"Khác",value:"khac"}],H=[{label:"Tất cả",value:""},{label:"Hành Động",value:"hanh-dong"},{label:"Cổ Trang",value:"co-trang"},{label:"Viễn Tưởng",value:"vien-tuong"},{label:"Bí Ẩn",value:"bi-an"},{label:"Tâm Lý",value:"tam-ly"},{label:"Âm Nhạc",value:"am-nhac"},{label:"Phiêu Lưu",value:"phieu-luu"},{label:"Chính Kịch",value:"chinh-kich"},{label:"Khoa Học",value:"khoa-hoc"},{label:"Học Đường",value:"hoc-duong"},{label:"Võ Thuật",value:"vo-thuat"},{label:"Chiến Tranh",value:"chien-tranh"},{label:"Hình Sự",value:"hinh-su"},{label:"Gia Đình",value:"gia-dinh"},{label:"Tình Cảm",value:"tinh-cam"},{label:"Thần Thoại",value:"than-thoai"},{label:"Thể Thao",value:"the-thao"},{label:"Kinh Dị",value:"kinh-di"},{label:"Kinh Điển",value:"kinh-dien"}],K=[{label:"Tất cả",value:""},{label:"Vietsub",value:"vietsub"},{label:"Thuyết Minh",value:"thuyet-minh"},{label:"Lồng Tiếng",value:"long-tieng"}],B=[{label:"Tất cả",value:""},...Array.from({length:new Date().getFullYear()-1999+1},(e,l)=>({label:`${new Date().getFullYear()-l}`,value:`${new Date().getFullYear()-l}`})).sort((e,l)=>parseInt(l.value)-parseInt(e.value))],E=[{label:"Mới nhất (theo ID)",value:"_id"},{label:"Thời gian cập nhật",value:"modified.time"},{label:"Năm phát hành",value:"year"}],T=r.useCallback((e=1)=>{const l=new URL(`${y}/v1/api/the-loai/${o}`);return l.searchParams.set("page",e.toString()),l.searchParams.set("limit",g.toString()),t.sort_field&&l.searchParams.set("sort_field",t.sort_field),t.sort_type&&l.searchParams.set("sort_type",t.sort_type),t.ngon_ngu&&l.searchParams.set("sort_lang",t.ngon_ngu),t.the_loai&&l.searchParams.set("category",t.the_loai),t.quoc_gia&&l.searchParams.set("country",t.quoc_gia),t.nam_phat_hanh&&l.searchParams.set("year",t.nam_phat_hanh),l.toString()},[t,y,o,g]),x=r.useCallback(async(e=1)=>{j(!0),N(null);try{const l=T(e),d=await fetch(l);if(!d.ok)throw new Error(`Lỗi khi fetch API: ${l} - Status: ${d.status}`);const L=await d.json();w(L.data?.items||[]),F(L.data?.params?.pagination||{current_page:1,total_pages:1});const s=new URL(`${window.location.origin}/the-loai/${o}`);s.searchParams.set("page",e.toString()),s.searchParams.set("limit",g.toString()),t.sort_field?s.searchParams.set("sort_field",t.sort_field):s.searchParams.delete("sort_field"),t.sort_type?s.searchParams.set("sort_type",t.sort_type):s.searchParams.delete("sort_type"),t.ngon_ngu?s.searchParams.set("sort_lang",t.ngon_ngu):s.searchParams.delete("sort_lang"),t.the_loai?s.searchParams.set("category",t.the_loai):s.searchParams.delete("category"),t.quoc_gia?s.searchParams.set("country",t.quoc_gia):s.searchParams.delete("country"),t.nam_phat_hanh?s.searchParams.set("year",t.nam_phat_hanh):s.searchParams.delete("year"),window.history.pushState(null,"",s.toString())}catch{N("Không thể tải phim. Vui lòng thử lại."),w([])}finally{j(!1)}},[T,t,g,o]),c=(e,l)=>{P(d=>({...d,[e]:l}))},I=()=>{x(1)},v=e=>{x(e)};r.useEffect(()=>{h!==o&&(M(h),P({quoc_gia:"",the_loai:"",ngon_ngu:"",nam_phat_hanh:"",sort_field:"_id",sort_type:"desc"}),x(1))},[h,o,x]);const k=[],$=Math.max(1,i-2),z=Math.min(f,$+4);for(let e=$;e<=z;e++)k.push(e);return a.jsxs("div",{children:[a.jsxs("div",{className:"",children:[a.jsxs("div",{className:"flex flex-row items-center justify-between gap-8 lg:justify-start",children:[a.jsxs("h1",{className:"lg:text-xl text-lg font-semibold text-white",children:["Tuyển Tập ",S]}),a.jsxs("button",{onClick:()=>C(!b),className:"flex items-center gap-1 transition-all",children:[a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"leading-none",children:a.jsx("path",{d:"M19 6H5c-1.1 0-1.4.6-.6 1.4l4.2 4.2c.8.8 1.4 2.3 1.4 3.4v5l4-2v-3.5c0-.8.6-2.1 1.4-2.9l4.2-4.2c.8-.8.5-1.4-.6-1.4"})}),a.jsx("span",{className:"text-xs font-medium leading-none text-white",children:"Bộ lọc"}),a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",className:`leading-none transition-transform duration-300 ${b?"rotate-180":"rotate-0"}`,children:a.jsx("path",{d:"M12 13.172L18.364 6.808l1.414 1.414L12 16L4.222 8.222l1.414-1.414L12 13.172z"})})]})]}),b&&a.jsxs("div",{className:"mt-4 flex flex-col gap-4 text-xs text-white border border-gray-200/20 rounded-lg p-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"mb-2 font-semibold",children:"Quốc gia:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(e=>a.jsx("button",{onClick:()=>c("quoc_gia",e.value),className:`rounded-lg px-3 py-1.5 ${t.quoc_gia===e.value?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:e.label},e.value))})]}),a.jsxs("div",{children:[a.jsx("p",{className:"mb-2 font-semibold",children:"Thể loại:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:H.map(e=>a.jsx("button",{onClick:()=>c("the_loai",e.value),className:`rounded-lg px-3 py-1.5 ${t.the_loai===e.value?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:e.label},e.value))})]}),a.jsxs("div",{children:[a.jsx("p",{className:"mb-2 font-semibold",children:"Ngôn ngữ:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:K.map(e=>a.jsx("button",{onClick:()=>c("ngon_ngu",e.value),className:`rounded-lg px-3 py-1.5 ${t.ngon_ngu===e.value?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:e.label},e.value))})]}),a.jsxs("div",{children:[a.jsx("p",{className:"mb-2 font-semibold",children:"Năm sản xuất:"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(e=>a.jsx("button",{onClick:()=>c("nam_phat_hanh",e.value),className:`rounded-lg px-3 py-1.5 ${t.nam_phat_hanh===e.value?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:e.label},e.value))})]}),a.jsxs("div",{children:[a.jsx("p",{className:"mb-2 font-semibold",children:"Sắp xếp:"}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[E.map(e=>a.jsx("button",{onClick:()=>c("sort_field",e.value),className:`rounded-lg px-3 py-1.5 ${t.sort_field===e.value?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:e.label},e.value)),a.jsx("button",{onClick:()=>c("sort_type",t.sort_type==="desc"?"asc":"desc"),className:`rounded-[4px] px-3 py-1 transition-colors duration-200 ${t.sort_type==="desc"?"border border-gray-700 text-[#ffd875]":"text-gray-200 hover:text-white"}`,children:t.sort_type==="desc"?"Giảm dần":"Tăng dần"})]})]}),a.jsxs("div",{className:"flex justify-start gap-2 mt-4",children:[a.jsx("button",{onClick:I,className:"rounded-full border border-[#ffd785] bg-[#ffd785] px-4 py-2 text-xs font-semibold text-black",disabled:n,children:"Tìm Kiếm"}),a.jsx("button",{onClick:()=>C(!1),className:"rounded-full border border-white px-4 py-2 text-xs font-semibold text-white ",children:"Đóng"})]})]})]}),u&&a.jsx("div",{className:"mt-8 text-center text-red-500",children:u}),!n&&!u&&p.length===0&&a.jsx("div",{className:"mt-8 text-center text-gray-400",children:"Không tìm thấy phim nào phù hợp."}),!n&&!u&&p.length>0&&a.jsx("div",{className:"mt-4 grid grid-cols-3 gap-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6",children:p.map(e=>{const l=`https://ik.imagekit.io/17mpki7mv/motchill/${e.poster_url}?tr=f-webp,w-300,h-450,fo-auto,q-85`;return a.jsxs("a",{href:`/phim/${e.slug}`,className:"group relative flex-shrink-0",children:[a.jsxs("div",{className:"relative aspect-[2/3] w-full overflow-hidden rounded-[4px]",children:[a.jsx("img",{src:l,alt:`Poster phim ${e.name}`,className:"h-full w-full object-cover",loading:"lazy"}),a.jsx("div",{className:"absolute bottom-0 left-0 h-[40%] w-full rounded-b-[4px]",style:{background:"linear-gradient(to top,rgba(30, 30, 30, 0.8) 5%, transparent 100%)"},"aria-hidden":"true"}),a.jsx("div",{className:"absolute inset-0 rounded-[4px] bg-black/20 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),a.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center opacity-0 transition-opacity duration-500 ease-in-out group-hover:opacity-100",children:a.jsxs("svg",{viewBox:"0 0 60 60",xmlns:"http://www.w3.org/2000/svg",className:"play-button h-[25px] w-[25px] transition-transform duration-700 sm:h-[30px] sm:w-[30px] ease-in-out",children:[a.jsx("circle",{cx:"30",cy:"30",r:"30",className:"fill-green-500 transition-colors duration-200"}),a.jsx("path",{d:"M35.7461509,22.4942263 L45.1405996,36.5858994 C46.059657,37.9644855 45.6871354,39.8270935 44.3085493,40.7461509 C43.8157468,41.0746859 43.2367237,41.25 42.6444487,41.25 L23.8555513,41.25 C22.198697,41.25 20.8555513,39.9068542 20.8555513,38.25 C20.8555513,37.657725 21.0308654,37.078702 21.3594004,36.5858994 L30.7538491,22.4942263 C31.6729065,21.1156403 33.5355145,20.7431187 34.9141006,21.662176 C35.2436575,21.8818806 35.5264463,22.1646695 35.7461509,22.4942263 Z",fill:"#FFFFFF",transform:"translate(33.25, 30) rotate(-270) translate(-33.25, -30)"})]})}),a.jsxs("div",{className:"absolute bottom-2 lg:bottom-0 left-2 lg:left-1/2 transform -translate-x-0 lg:-translate-x-1/2 flex flex-col lg:flex-row z-20 text-[10px] lg:text-[11px] font-semibold leading-tight text-white gap-1 lg:gap-0",children:[a.jsx("span",{className:"whitespace-nowrap px-2 py-0.5 lg:py-1 rounded-md lg:rounded-none lg:rounded-tl-md bg-[#5e6070]","aria-label":`Tình trạng phim: ${e.episode_current}`,children:V(e.episode_current)}),a.jsx("span",{className:"whitespace-nowrap w-fit px-2 py-0.5 lg:py-1 rounded-md lg:rounded-none lg:rounded-tr-md bg-[#2ca35d]","aria-label":`Ngôn ngữ phim: ${e.lang}`,children:A(e.lang)})]}),a.jsx("div",{className:"absolute top-2 left-2 bg-black/70 backdrop-blur-3xl rounded-md py-1 px-2 shadow-md",children:a.jsxs("div",{className:"flex flex-row items-center gap-1 font-bold justify-center text-white text-[10px] lg:text-xs leading-tight",children:[a.jsx("p",{className:"text-[#f0d25c]",children:"IMDb"}),a.jsx("p",{className:"flex items-center",children:e.tmdb.vote_average===0?10:e.tmdb.vote_average.toFixed(1)})]})})]}),a.jsx("div",{className:"pt-2 pb-4",children:a.jsx("p",{className:"line-clamp-2 text-[13px] font-semibold text-gray-200 hover:text-[#ffd785]",title:e.name,children:e.name})})]},e._id)})}),f>1&&a.jsxs("nav",{className:"mt-8 flex flex-wrap items-center justify-center gap-2",children:[i>1&&a.jsx("button",{onClick:()=>v(i-1),className:"flex h-8 w-8 items-center justify-center rounded-[4px] border border-gray-600 bg-[#23252b] text-sm text-gray-300 hover:bg-gray-600","aria-label":"Trang trước",disabled:n,children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:a.jsx("path",{fill:"currentColor",d:"m2 10l8 8l1.4-1.4L5.8 11H18V9H5.8l5.6-5.6L10 2z"})})}),k.map(e=>a.jsx("button",{onClick:()=>v(e),className:`flex h-8 w-8 items-center justify-center rounded-[4px] border text-sm ${i===e?"border-green-400 bg-green-500 text-white":"border-gray-600 bg-[#23252b] text-gray-300 hover:bg-gray-600"}`,disabled:n,children:e},e)),i<f&&a.jsx("button",{onClick:()=>v(i+1),className:"flex h-8 w-8 items-center justify-center rounded-[4px] border border-gray-600 bg-[#23252b] text-sm text-gray-300 hover:bg-gray-600","aria-label":"Trang sau",disabled:n,children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 20 20",children:a.jsx("path",{fill:"currentColor",d:"M8.6 3.4L14.2 9H2v2h12.2l-5.6 5.6L10 18l8-8l-8-8z"})})})]})]})}export{G as default};
